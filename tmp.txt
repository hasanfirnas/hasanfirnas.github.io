function main(workbook: ExcelScript.Workbook) {
  // Get the table named "OutputTable"
  const table = workbook.getTable("OutputTable");

  // Get table data (headers + rows)
  const headers = table.getHeaderRowRange().getValues()[0].map(h => h.toString().trim());
  const rows = table.getRangeBetweenHeaderAndTotal().getValues();

  // Find the CMDB Status column index in the table
  const statusColIndex = headers.findIndex(h => h.toLowerCase() === "cmdb status");
  if (statusColIndex === -1) {
    throw new Error('CMDB Status column not found in OutputTable.');
  }

  // Prepare JSON result
  let result: { RATM: string; ID: string }[] = [];

  // Loop through each row in the table
  for (let i = 0; i < rows.length; i++) {
    let id = rows[i][0];   // Column A inside the table → ID
    let ratm = rows[i][9]; // Column J inside the table → RATM
    let status = rows[i][statusColIndex];

    // Skip if missing ID or RATM
    if (!id || !ratm) continue;

    // Skip if CMDB Status is "Closed Complete" or "Cancelled"
    if (status) {
      let statusText = status.toString().trim().toLowerCase();
      if (statusText === "closed complete" || statusText === "cancelled") {
        continue;
      }
    }

    // Add to result
    result.push({
      RATM: ratm.toString().trim(),
      ID: id.toString().trim()
    });
  }

  // Return JSON object
  return { records: result };
}
