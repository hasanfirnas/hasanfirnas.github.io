function main(workbook: ExcelScript.Workbook, ritmId: string): string {
  // Constants - Update these if your sheet/table names are different
  const OUTPUT_SHEET_NAME = "output";
  const OUTPUT_TABLE_NAME = "OutputTable";
  const FORMS_SHEET_NAME = "Sheet1";
  const FORMS_TABLE_NAME = "OfficeForms.Table";
  
  // Try to get the sheets
  const outputSheet = workbook.getWorksheet(OUTPUT_SHEET_NAME);
  const formsSheet = workbook.getWorksheet(FORMS_SHEET_NAME);
  
  if (!outputSheet || !formsSheet) {
    return JSON.stringify({ 
      error: "Required sheets not found",
      status: "ERROR" 
    });
  }
  
  // Try to get the tables
  const outputTable = outputSheet.getTable(OUTPUT_TABLE_NAME);
  const formsTable = formsSheet.getTable(FORMS_TABLE_NAME);
  
  if (!outputTable || !formsTable) {
    return JSON.stringify({ 
      error: "Required tables not found",
      status: "ERROR" 
    });
  }
  
  // Get RITM column (Column C) from OutputTable
  const outputData = outputTable.getRangeBetweenHeaderAndTotal().getValues();
  const ritmColumnIndex = 2; // Column C is index 2 (0-based: A=0, B=1, C=2)
  
  // Search for RITM ID in OutputTable
  let foundRowIndex = -1;
  let rowId = "";
  
  for (let i = 0; i < outputData.length; i++) {
    const cellValue = outputData[i][ritmColumnIndex];
    if (cellValue && cellValue.toString().includes(ritmId)) {
      foundRowIndex = i;
      // Get the ID from column A of the same row
      rowId = outputData[i][0]?.toString() || "";
      break;
    }
  }
  
  // Scenario 1: RITM not found in OutputTable
  if (foundRowIndex === -1) {
    return JSON.stringify({
      status: "ENEW"
    });
  }
  
  // Scenario 2: RITM found - now check FormsTable
  const formsData = formsTable.getRangeBetweenHeaderAndTotal().getValues();
  const idColumnIndex = 0; // Column A for ID
  
  // Search for the rowId in FormsTable
  let formsRowIndex = -1;
  
  for (let i = 0; i < formsData.length; i++) {
    const cellValue = formsData[i][idColumnIndex];
    if (cellValue && cellValue.toString() === rowId) {
      formsRowIndex = i;
      break;
    }
  }
  
  if (formsRowIndex === -1) {
    return JSON.stringify({
      status: "ERROR",
      message: "ID not found in Forms table"
    });
  }
  
  // Get the specific row range to check formatting
  const formsTableRange = formsTable.getRangeBetweenHeaderAndTotal();
  const targetRowRange = formsTableRange.getRow(formsRowIndex);
  
  // Check if the row has strikethrough formatting
  let hasStrikethrough = false;
  // Check if any cell in the row has strikethrough
  for (let col = 0; col < targetRowRange.getColumnCount(); col++) {
    const cell = targetRowRange.getCell(0, col);
    const font = cell.getFormat().getFont();
    if (font.getStrikethrough()) {
      hasStrikethrough = true;
      break;
    }
  }
  
  // Get the fill color of the first cell in the row (for color check)
  const firstCell = targetRowRange.getCell(0, 0);
  const fillColor = firstCell.getFormat().getFill().getColor();
  
  // Function to check if color is red or yellow
  function isRedOrYellow(color: string): boolean {
    // Convert to lowercase for comparison
    const lowerColor = color.toLowerCase();
    
    // Check for red colors (common red shades)
    if (lowerColor.includes("ff0000") || 
        lowerColor.includes("ff6b6b") ||
        lowerColor.includes("dc143c") ||
        lowerColor.includes("c00000")) {
      return true;
    }
    
    // Check for yellow colors (common yellow shades)
    if (lowerColor.includes("ffff00") ||
        lowerColor.includes("ffd700") ||
        lowerColor.includes("ffeb3b") ||
        lowerColor.includes("ffc000")) {
      return true;
    }
    
    return false;
  }
  
  const isColored = isRedOrYellow(fillColor);
  
  // Check if row is striked off AND colored (red or yellow)
  if (hasStrikethrough && isColored) {
    return JSON.stringify({
      status: "NEW"
    });
  }
  
  // If not striked off, get email from column D (index 3)
  const emailColumnIndex = 3; // Column D is index 3
  const email = formsData[formsRowIndex][emailColumnIndex]?.toString() || "";
  
  // Return all information in JSON format
  return JSON.stringify({
    RITM_ID: ritmId,
    ID: rowId,
    Email: email,
    status: "FOUND"
  });
}
