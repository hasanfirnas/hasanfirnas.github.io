function main(workbook: ExcelScript.Workbook) {
  // Get the active worksheet
  const sheet = workbook.getActiveWorksheet();

  // Get used range values
  const usedRange = sheet.getUsedRange();
  const values = usedRange.getValues();

  // Find the column index for "CMDB Status" (header row search)
  const headers = values[0].map(h => h.toString().trim());
  const statusColIndex = headers.findIndex(h => h.toLowerCase() === "cmdb status");

  if (statusColIndex === -1) {
    throw new Error('CMDB Status column not found.');
  }

  // Prepare JSON result
  let result: { RATM: string; ID: string }[] = [];

  // Loop through each row (skip header row)
  for (let i = 1; i < values.length; i++) {
    let id = values[i][0];    // Column A → ID
    let ratm = values[i][9];  // Column J → RATM
    let status = values[i][statusColIndex];

    // Skip if missing ID or RATM
    if (!id || !ratm) continue;

    // Skip if CMDB Status is "Closed Complete" or "Cancelled"
    if (status) {
      let statusText = status.toString().trim().toLowerCase();
      if (statusText === "closed complete" || statusText === "cancelled") {
        continue;
      }
    }

    // Add to result
    result.push({
      RATM: ratm.toString().trim(),
      ID: id.toString().trim()
    });
  }

  // Return JSON object
  return { records: result };
}
