function main(workbook: ExcelScript.Workbook) {
  const SOURCE_SHEET = "Sheet1";
  const SOURCE_TABLE = "OfficeForms.Table";
  const BIN_SHEET = "Bin";
  const BIN_TABLE = "Bin.Table";

  const DRY_RUN = false; // üî¥ SET true to preview, false to execute

  const sourceSheet = workbook.getWorksheet(SOURCE_SHEET);
  const sourceTable = sourceSheet.getTable(SOURCE_TABLE);

  const binSheet = workbook.getWorksheet(BIN_SHEET);
  const binTable = binSheet.getTable(BIN_TABLE);

  // ‚ùó HARD SAFETY CHECK ‚Äî FILTERS MUST BE OFF
  if (sourceSheet.getAutoFilter()) {
    throw new Error(
      "‚ùå Filters are ON in the source sheet. Please clear all filters and re-run the script."
    );
  }

  const sourceBody = sourceTable.getRangeBetweenHeaderAndTotal();
  const values = sourceBody.getValues();
  const rowCount = sourceBody.getRowCount();
  const colCount = sourceTable.getColumns().length;

  const rowsToMove: number[] = [];
  const valuesToMove: (string | number | boolean)[][] = [];

  const CANONICAL_RED = "#ff0000";

  function isRed(color: string | null): boolean {
    if (!color) return false;
    return color.toLowerCase() === CANONICAL_RED;
  }

  // STEP 1: Detect rows
  for (let i = 0; i < rowCount; i++) {
    const rowRange = sourceBody.getRow(i);
    const struck = rowRange.getFormat().getFont().getStrikethrough();
    const fill = rowRange.getFormat().getFill().getColor();

    if (struck && isRed(fill)) {
      rowsToMove.push(i);
      valuesToMove.push(values[i]);
    }
  }

  console.log(`Found ${rowsToMove.length} rows to move.`);
  rowsToMove.forEach(i => console.log(`Row index (body): ${i}`));

  if (DRY_RUN) {
    console.log("üü° DRY RUN enabled. No changes applied.");
    return;
  }

  // STEP 2: BULK ADD TO BIN
  binTable.addRows(-1, valuesToMove);

  // STEP 3: APPLY FORMATTING TO BIN ROWS
  const binBody = binTable.getRangeBetweenHeaderAndTotal();
  const startRow = binBody.getRowCount() - valuesToMove.length;

  for (let r = 0; r < valuesToMove.length; r++) {
    const row = binBody.getRow(startRow + r);
    row.getFormat().getFill().setColor(CANONICAL_RED);
    row.getFormat().getFont().setStrikethrough(true);
  }

  // STEP 4: DELETE SOURCE ROWS (BOTTOM ‚Üí TOP)
  rowsToMove.sort((a, b) => b - a).forEach(index => {
    sourceTable.deleteRowsAt(index, 1);
  });

  console.log(`‚úÖ Successfully moved ${rowsToMove.length} rows to Bin.`);
}
