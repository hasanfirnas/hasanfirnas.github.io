function main(workbook: ExcelScript.Workbook) {
  // === PART 1: Build JSON from OutputTable ===

  const table = workbook.getTable("OutputTable");
  if (!table) {
    throw new Error('Table "OutputTable" not found.');
  }

  const headers = table.getHeaderRowRange().getValues()[0].map(h => h.toString().trim());
  const rows = table.getRangeBetweenHeaderAndTotal().getValues();

  const statusColIndex = headers.findIndex(h => h.toLowerCase() === "cmdb status");
  if (statusColIndex === -1) {
    throw new Error('CMDB Status column not found in OutputTable.');
  }

  let result: {
    RITM: string;ID: string
  } [] = [];

  for (let i = 0; i < rows.length; i++) {
    let id = rows[i][0];
    let ritm = rows[i][2];
    let status = rows[i][statusColIndex];

    if (!id || !ritm) continue;

    if (status) {
      let statusText = status.toString().trim().toLowerCase();
      if (statusText === "closed complete" || statusText === "cancelled") continue;
    }

    result.push({
      RITM: ritm.toString().trim(),
      ID: id.toString().trim()
    });
  }

  // === PART 2: Delete "CMDB Status" column from another table ===
try {
  const otherTable = workbook.getTable("OfficeForms.Table"); // change table name
  const headers = otherTable.getHeaderRowRange().getValues()[0];
  const colIndex = headers.findIndex((h: string) => h.trim().toLowerCase() === "cmdb status");
  if (colIndex !== -1) {
    const dataRange: ExcelScript.Range = otherTable
      .getRangeBetweenHeaderAndTotal()
      .getColumn(colIndex);
    dataRange.clear(ExcelScript.ClearApplyTo.contents);
  }
} catch (err) {}

  // === PART 3: Output JSON ===
  console.log(JSON.stringify({
    records: result
  }, null, 2));
  return {
    records: result
  };
}
